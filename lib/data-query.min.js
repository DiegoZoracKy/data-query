/*global angular*/
/**
 * Query / Filter a set of Object Literal (‘JSON’), that could be an Array or Object Literal.
 *
 * @author Diego ZoracKy, @diegozoracky | https://github.com/DiegoZoracKy/data-query
 *
 * @param   {Array | Object Literal}    dataSrc - Dataset do be filtered / queried
 * @param   {String | Object Literal | Function}   filter - Properties path to be checked
 * @param   {String | Object Literal | RegEx}   filterValue - Value to be checked against the properties path
 * @return  {Array | Object Literal}    Dataset Filtered
 */
var dataQuery=function(){"use strict";function t(t,r){var n=[];for(var o in t)n.push(t[o]),r&&(n[n.length-1]._rootKey=o);return n}function r(r,n,e){if(r&&n){if(r.constructor==Array)return r.filter(function(t){return n.constructor==Function?n(t):o(t,n,e)});if(r.constructor==Object){var c={};r=t(r,!0),r=r.filter(function(t){return n.constructor==Function?n(t):o(t,n,e)});for(var u in r)c[r[u]._rootKey]=r[u],delete c[r[u]._rootKey]._rootKey;return c}}}function n(t,r){if(void 0===t||void 0===r)return!1;if(t.constructor===Date&&r.constructor===Date)return t.getTime()===r.getTime();if(r.constructor==Function)return r(t);if(t.constructor==Array&&r.constructor==Array){if(t.length!=r.length)return!1;var n=t.slice().sort(),e=r.slice().sort();return n.every(function(t,r){return e[r].constructor==RegExp?!!t.toString().match(e[r]):e[r]==t})}return t.constructor==Array?t.some(function(t){return t.constructor==Object&&r.constructor==Object?o(t,r):r.constructor==RegExp?!!t.toString().match(r):r==t}):r.constructor==Object&&t.constructor==Object?o(t,r):r.constructor==RegExp?!!t.toString().match(r):t==r}function o(t,r,c){var u=!0;if(r.constructor==String)return"undefined"!=typeof c?n(e(t,r),c):"undefined"!=typeof e(t,r);if(r.constructor==Object)for(var i in r)u&=i.match(/\./)?n(e(t,i),r[i]):t[i]&&t[i].constructor==Object&&r[i].constructor==Object?o(t[i],r[i]):n(t[i],r[i]);return u}function e(t,r){return r?(r.split(".").forEach(function(r){if(t){var n=r.match(/^\/(.*)\/$/);n&&(r=new RegExp(n[1],"gi")),r.constructor==RegExp?Object.keys(t).forEach(function(n){n.match(r)&&(t=t[n])}):t=t[r]}}),t):t}return function(t,n,o){return r(t,n,o)}}();"undefined"!=typeof module&&module.exports&&(module.exports=dataQuery),"undefined"!=typeof angular&&angular.module("zk.dataQuery",[]).factory("dataQuery",function(){return dataQuery}).filter("dataQuery",["dataQuery",function(t){return function(r,n,o){return t(r,n,o)}}]);